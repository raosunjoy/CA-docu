// Quick AI Integration Test
// Run with: node test-ai-integration.js

const testAIEndpoints = async () => {
  const baseUrl = 'http://localhost:3000'
  
  console.log('ğŸš€ Testing AI Integration Endpoints...\n')

  // Test 1: AI Processing Endpoint
  try {
    console.log('ğŸ“¤ Testing /api/ai/process...')
    
    const aiResponse = await fetch(`${baseUrl}/api/ai/process`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        type: 'AI',
        data: {
          message: 'What are the key GST compliance requirements?',
          context: {
            documentType: 'GENERAL'
          }
        },
        userId: 'test-user-123',
        context: {
          userRole: 'ASSOCIATE',
          businessContext: 'compliance_query',
          priority: 'MEDIUM'
        }
      })
    })

    if (aiResponse.ok) {
      const result = await aiResponse.json()
      console.log('âœ… AI Processing: SUCCESS')
      console.log('ğŸ“Š Response:', JSON.stringify(result, null, 2).slice(0, 300) + '...\n')
    } else {
      console.log('âŒ AI Processing: FAILED', aiResponse.status, await aiResponse.text())
    }
  } catch (error) {
    console.log('âŒ AI Processing: ERROR', error.message)
  }

  // Test 2: Email Categorization
  try {
    console.log('ğŸ“¤ Testing /api/emails/categorize...')
    
    const emailResponse = await fetch(`${baseUrl}/api/emails/categorize`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        emails: [
          {
            id: 'test-email-1',
            subject: 'Urgent: GST Return Filing Deadline',
            fromName: 'Client ABC Ltd',
            fromAddress: 'finance@abc.com',
            snippet: 'We need urgent help with GST return filing for March 2024...'
          }
        ],
        userRole: 'ASSOCIATE'
      })
    })

    if (emailResponse.ok) {
      const result = await emailResponse.json()
      console.log('âœ… Email Categorization: SUCCESS')
      console.log('ğŸ“Š Categorized:', result.data.categorizedEmails.length, 'emails')
      console.log('ğŸ·ï¸ Categories found:', result.data.summary.categoriesFound.join(', '))
      console.log('')
    } else {
      console.log('âŒ Email Categorization: FAILED', emailResponse.status)
    }
  } catch (error) {
    console.log('âŒ Email Categorization: ERROR', error.message)
  }

  // Test 3: Task Creation
  try {
    console.log('ğŸ“¤ Testing /api/tasks...')
    
    const taskResponse = await fetch(`${baseUrl}/api/tasks`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        title: 'AI Generated Task: Review GST Compliance',
        description: 'Generated by AI from email analysis - urgent GST filing required',
        priority: 'HIGH',
        tags: ['AI-Generated', 'GST', 'Compliance'],
        estimatedTime: '2 hours'
      })
    })

    if (taskResponse.ok) {
      const result = await taskResponse.json()
      console.log('âœ… Task Creation: SUCCESS')
      console.log('ğŸ“‹ Task ID:', result.data.task.id)
      console.log('ğŸ¯ Priority:', result.data.task.priority)
      console.log('')
    } else {
      console.log('âŒ Task Creation: FAILED', taskResponse.status, await taskResponse.text())
    }
  } catch (error) {
    console.log('âŒ Task Creation: ERROR', error.message)
  }

  // Test 4: Health Checks
  try {
    console.log('ğŸ“¤ Testing API health...')
    
    const healthResponse = await fetch(`${baseUrl}/api/ai/process`)
    if (healthResponse.ok) {
      const result = await healthResponse.json()
      console.log('âœ… AI API Health: SUCCESS')
      console.log('ğŸ¯ Status:', result.status)
      console.log('âš™ï¸ Capabilities:', result.capabilities.join(', '))
    }
  } catch (error) {
    console.log('âŒ Health Check: ERROR', error.message)
  }

  console.log('\nğŸ‰ AI Integration Test Complete!')
  console.log('ğŸ’¡ Note: Some services may show mock responses when OpenAI API is not configured')
}

// Run the test
testAIEndpoints().catch(console.error)